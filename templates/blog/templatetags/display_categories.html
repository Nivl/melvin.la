{% load get_range %}

{% for object in nested_tree %}

  {% ifequal object "level_down" %}</ul></li>
  {% else %}
    {% ifequal object "level_up" %}<ul>
    {% else %}
      <li>
        <a href="{{ object.get_absolute_url }}">{{ object.name }}</a>

	{% if not object.has_child %}
          </li>
          {% if forloop.last %}
            {% for i in object.level|get_range %}
              </ul></li>
            {% endfor %}
          {% endif %}
	{% endif %}
    {% endifequal %}
  {% endifequal %}

{% empty %}
    <li>No category.</li>
{% endfor %}

